const BACKEND_URL = "https://fund.eazeconsulting.com/api/check-scan-status";
// const BACKEND_URL = "http://localhost:3000/api/check-scan-status";

export const waitForSafeScan = async (fileKey: string): Promise<boolean> => {
  const MAX_RETRIES = 10;
  const DELAY = 3000; // 3 seconds between checks

  for (let i = 0; i < MAX_RETRIES; i++) {
    try {
      const response = await fetch(`${BACKEND_URL}?key=${fileKey}`);
      const data = await response.json();

      if (data.status === "NO_THREATS_FOUND") return true;
      if (data.status === "THREATS_FOUND") return false;

      // If still "SCANNING", wait and try again
      await new Promise((resolve) => setTimeout(resolve, DELAY));
    } catch (error) {
      console.error("Error checking scan status:", error);
    }
  }

  throw new Error("Scan timed out. Please try again.");
};